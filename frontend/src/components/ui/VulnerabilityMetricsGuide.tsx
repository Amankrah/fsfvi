'use client';

import React from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Info, AlertTriangle, BarChart3, DollarSign } from 'lucide-react';

interface VulnerabilityMetricsGuideProps {
  showExamples?: boolean;
  compact?: boolean;
}

export const VulnerabilityMetricsGuide: React.FC<VulnerabilityMetricsGuideProps> = ({ 
  showExamples = true, 
  compact = false 
}) => {
  if (compact) {
    return (
      <Card className="bg-blue-50 border-blue-200">
        <CardContent className="p-4">
          <div className="flex items-start space-x-3">
            <Info className="w-5 h-5 text-blue-600 mt-0.5" />
            <div className="space-y-2 text-sm text-blue-800">
              <div>
                <strong>Efficiency Index:</strong> Measures resource effectiveness = (1 - vulnerability) / allocation × 1000
              </div>
              <div>
                <strong>Critical Risk:</strong> Multi-factor assessment: vulnerability + financial exposure + system importance
              </div>
              <div>
                <strong>FSFVI Formula:</strong> υᵢ(fᵢ) = δᵢ · 1/(1 + αᵢfᵢ) with diminishing returns
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="bg-yellow-50 border-yellow-200">
      <CardHeader>
        <CardTitle className="flex items-center text-yellow-900">
          <Info className="w-5 h-5 mr-2" />
          Understanding FSFVI Metrics
        </CardTitle>
        <CardDescription className="text-yellow-800">
          Comprehensive guide to vulnerability analysis concepts
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Efficiency Index */}
        <div className="p-4 bg-white rounded-lg border border-yellow-300">
          <div className="flex items-center mb-3">
            <BarChart3 className="w-4 h-4 text-green-600 mr-2" />
            <h4 className="text-sm font-semibold text-yellow-900">Efficiency Index</h4>
          </div>
          <div className="text-sm text-yellow-800 space-y-2">
            <div className="bg-gray-100 p-2 rounded font-mono text-xs">
              Efficiency = (1 - vulnerability) / allocation × 1000
            </div>
            
            <div><strong>Purpose:</strong> Measures how effectively each dollar reduces vulnerability</div>
            
            {showExamples && (
              <div className="bg-green-50 p-3 rounded border-l-4 border-green-400">
                <div className="font-medium text-green-800 mb-1">Example Calculation:</div>
                <div className="text-xs space-y-1">
                  <div>• Component vulnerability: 35.6%</div>
                  <div>• Effectiveness: 100% - 35.6% = 64.4%</div>
                  <div>• Allocation: $2,399.5M</div>
                  <div>• Efficiency: (0.644 / 2399.5) × 1000 = 26.8%</div>
                </div>
              </div>
            )}
            
            <div className="grid grid-cols-2 gap-2 text-xs">
              <div><strong>High (&gt;50%):</strong> Very efficient use of resources</div>
              <div><strong>Medium (20-50%):</strong> Moderate efficiency</div>
              <div><strong>Low (&lt;20%):</strong> Poor resource utilization</div>
              <div><strong>Very Low (&lt;10%):</strong> Inefficient spending</div>
            </div>
          </div>
        </div>

        {/* Risk Level Determination */}
        <div className="p-4 bg-white rounded-lg border border-yellow-300">
          <div className="flex items-center mb-3">
            <AlertTriangle className="w-4 h-4 text-red-600 mr-2" />
            <h4 className="text-sm font-semibold text-yellow-900">Robust Risk Assessment</h4>
          </div>
          <div className="text-sm text-yellow-800 space-y-2">
            <div className="bg-gray-100 p-2 rounded font-mono text-xs">
              Risk = Vulnerability × (1 + 0.3×Financial_Factor + 0.2×Importance_Factor)
            </div>
            
            <div><strong>Multi-Factor Logic:</strong> Risk considers vulnerability, financial exposure, and system importance</div>
            
            {showExamples && (
              <div className="bg-red-50 p-3 rounded border-l-4 border-red-400">
                <div className="font-medium text-red-800 mb-1">Enhanced Risk Analysis:</div>
                <div className="text-xs space-y-1">
                  <div>• Base Vulnerability: 35.6%</div>
                  <div>• Financial Factor: √(allocation_share) = √(0.825) = 0.91</div>
                  <div>• Importance Factor: weight^0.3 = 0.244^0.3 = 0.63</div>
                  <div>• Composite Risk: 35.6% × (1 + 0.3×0.91 + 0.2×0.63) = ~45%</div>
                  <div>• Result: <span className="font-bold">CRITICAL</span> (≥60% threshold with adjustments)</div>
                </div>
              </div>
            )}
            
            <div className="grid grid-cols-4 gap-1 text-xs">
              <div className="bg-red-100 p-2 rounded text-center">
                <div className="font-bold text-red-800">Critical</div>
                <div>Composite<br/>≥60%</div>
              </div>
              <div className="bg-orange-100 p-2 rounded text-center">
                <div className="font-bold text-orange-800">High</div>
                <div>Composite<br/>≥40%</div>
              </div>
              <div className="bg-yellow-100 p-2 rounded text-center">
                <div className="font-bold text-yellow-800">Medium</div>
                <div>Composite<br/>≥25%</div>
              </div>
              <div className="bg-green-100 p-2 rounded text-center">
                <div className="font-bold text-green-800">Low</div>
                <div>Composite<br/>&lt;25%</div>
              </div>
            </div>
          </div>
        </div>

        {/* FSFVI Mathematical Framework */}
        <div className="p-4 bg-white rounded-lg border border-yellow-300">
          <div className="flex items-center mb-3">
            <span className="text-blue-600 mr-2 font-bold">∫</span>
            <h4 className="text-sm font-semibold text-yellow-900">FSFVI Mathematical Framework</h4>
          </div>
          <div className="text-sm text-yellow-800 space-y-2">
            <div className="bg-gray-100 p-2 rounded font-mono text-xs text-center">
              υᵢ(fᵢ) = δᵢ · 1/(1 + αᵢfᵢ)
            </div>
            
            <div><strong>Concept:</strong> Vulnerability decreases with funding but with diminishing returns</div>
            
            <div className="grid grid-cols-2 gap-2 text-xs">
              <div><strong>υᵢ:</strong> Component vulnerability [0,1]</div>
              <div><strong>δᵢ:</strong> Performance gap [0,1]</div>
              <div><strong>αᵢ:</strong> Sensitivity parameter (funding response)</div>
              <div><strong>fᵢ:</strong> Financial allocation (millions USD)</div>
            </div>
            
            <div className="bg-blue-50 p-3 rounded border-l-4 border-blue-400">
              <div className="font-medium text-blue-800 mb-1">Key Properties:</div>
              <div className="text-xs space-y-1">
                <div>• Higher funding → Lower vulnerability</div>
                <div>• Diminishing returns: first dollars most effective</div>
                <div>• Sensitivity varies by component type</div>
                <div>• Performance gap is the baseline vulnerability</div>
              </div>
            </div>
          </div>
        </div>

        {/* Budget Calculations */}
        <div className="p-4 bg-white rounded-lg border border-yellow-300">
          <div className="flex items-center mb-3">
            <DollarSign className="w-4 h-4 text-green-600 mr-2" />
            <h4 className="text-sm font-semibold text-yellow-900">Budget Analysis</h4>
          </div>
          <div className="text-sm text-yellow-800 space-y-2">
            <div><strong>Total Budget:</strong> Sum of all component allocations</div>
            <div><strong>Budget at Risk:</strong> Funding allocated to critical and high-risk components</div>
            <div><strong>Risk Percentage:</strong> Proportion of budget requiring immediate attention</div>
            
            <div className="bg-yellow-100 p-3 rounded border-l-4 border-yellow-400">
              <div className="font-medium text-yellow-800 mb-1">Interpretation:</div>
              <div className="text-xs space-y-1">
                <div>• High budget at risk (&gt;50%): System-wide vulnerability</div>
                <div>• Moderate risk (20-50%): Targeted interventions needed</div>
                <div>• Low risk (&lt;20%): Generally stable system</div>
              </div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default VulnerabilityMetricsGuide; 